// DICTIONARIES
var coord = {
    "x1": [51.914444, 4.470009], //DF
    "x2": [51.906289, 4.442124], //DF
    "x3": [51.906333, 4.492452], //DW
    "x4": [51.928074, 4.476836], //DW
    "x5": [51.912516, 4.501322], //PG
    "x6": [51.928861, 4.480778], //PG
    "x7": [51.916006, 4.476677] //END
}

var audioWhile = {
  "LatLng(51.914444, 4.470009)":"audio/audioWhile/dragonfly.mp3", //DF
  "LatLng(51.906289, 4.442124)":"audio/audioWhile/dragonfly.mp3", //DF
  "LatLng(51.906333, 4.492452)":"audio/audioWhile/dolphinwaves.mp3", //DW
  "LatLng(51.928074, 4.476836)":"audio/audioWhile/dolphinwaves.mp3", //DW
  "LatLng(51.912516, 4.501322)":"audio/audioWhile/progectgecko.mp3", //PG
  "LatLng(51.928861, 4.480778)":"audio/audioWhile/progectgecko.mp3", //PG
  "LatLng(51.916006, 4.476677)":"audio/outro.mp3"
}

var audioWhileX = {
  "x1":"audio/audioWhile/dragonfly.mp3", //DF
  "x2":"audio/audioWhile/dragonfly.mp3", //DF
  "x3":"audio/audioWhile/dolphinwaves.mp3", //DW
  "x4":"audio/audioWhile/dolphinwaves.mp3", //DW
  "x5":"audio/audioWhile/progectgecko.mp3", //PG
  "x6":"audio/audioWhile/progectgecko.mp3", //PG
  "x7":"audio/outro.mp3"
}

var getSymb = {
  "x1":"look around", //DW
  "x2":"look around", //DW
  "x3":"look around", //DF
  "x4":"look around", //DF
  "x5":"look around", //PG
  "x6":"look around", //PG
  "x7":"look around and take the stairs"
}

var codeword = {
  "x1": 'SAFETY', //DF
  "x2": 'DESIGN', //DF
  "x3": 'FLOTATION', //DW
  "x4": 'AUTOMATION', //DW
  "x5": 'EMBODIED', //PG
  "x6": 'VISIBLE', //PG
  "x7": 'COEXIST' //END
}

var title = {
    "x1":"Dragonfly // Het Nieuwe Instituut", //DF
    "x2":"Dragonfly // Dakpark", //DF
    "x3":"Dolphin Waves // Floating Pavilion", //DW
    "x4":"Dolphin Waves // Benthemplein", //DW
    "x5":"Project Gecko // Hef Park", //PG
    "x6":"Project Gecko // Almondestraat", //PG
    "x7":"The Roof" //END
}



var titleWhile = {
  "LatLng(51.914444, 4.470009)":"Dragonfly // Het Nieuwe Instituut", //DF
  "LatLng(51.906289, 4.442124)":"Dragonfly // Dakpark", //DF
  "LatLng(51.906333, 4.492452)":"Dolphin Waves // Floating Pavilion", //DW
  "LatLng(51.928074, 4.476836)":"Dolphin Waves // Benthemplein", //DW
  "LatLng(51.912516, 4.501322)":"Project Gecko // Hef Park", //PG
  "LatLng(51.928861, 4.480778)":"Project Gecko // Almondestraat", //PG
  "LatLng(51.916006, 4.476677)":"The Roof" //END
}

var textQuest = {
    "x1":"When the world suffers a collective trauma, and every step on every street reminds you of the harm and pain, what do you do? Do we depend on individuals and our local communities to slowly heal and grow again, or might we depend on artificial influences to stimulate our wellbeing? Should we put hurting memories on scaffolding, building over them to try to erase the pain, or do we leave stretch marks of change?  ", //DF
    "x2":"Just like the bees and the flowers, weâ€™ve helped humans connect with each other beyond the flowerbeds they would have otherwise stayed in. Letting flowers root beyond the concrete boxes designed for them, finding ways for global ecosystems and collectives to harmonize. Would the bee be a welcome presence in your flowerbed? Or might we have rooted enough?", //DF
    "x3":"I am trying to read what you are thinking right now. I am watching you from inside the pavilion. I wonder, what would your game world look like? Would you feel this same sensation of excitement of discovering yourself everyday anew? Would you, like I did, move beyond ideas in which only the physical is real and immerse yourself in infinite worlds? Would you allow artificial influences to help you shape realities?", //DW
    "x4":"Would you agree that everything you can think of is a product of an entire world of influences surrounding you? If so, is your imagination really yours to keep? Might it feel extremely liberating, to leave behind all worries about labour for profit for income to survive, in exchange for a limitless access to your thinking? Or are your thoughts really the sole things that truly are pricelessly yours?", //DW
    "x5":"Was the chicken first or the egg? ", //PG
    "x6":"Would you rather fight a horse sized duck or 100 duck sized horses?", //PG
    "x7":""
}

var audioQuest = {
  "x1":"audio/audioQuest/DF_hetnieuwe.mp3", //DW
  "x2":"audio/audioQuest/DF_dakpark.mp3", //DW
  "x3":"audio/audioQuest/intro.wav", //DF
  "x4":"audio/audioQuest/intro.wav", //DF
  "x5":"audio/audioQuest/intro.wav", //PG
  "x6":"audio/audioQuest/intro.wav", //PG
  "x7":"audio/outro.mp3"
}

var button = {
    "x1":["Build Over Them","Leave Stretch Marks"], //DW
    "x2":["Welcome the Bee","We Have Rooted Enough"], //DW
    "x3":["Immerse Yourself in Infinite Worlds","Stay Grounded Inside Physical World"],//DF,
    "x4":["Give Limitless Access in Exchange for Freedom of Labour","Work for Your Money in Order to Keep Ownership of Your Thoughts"], //DF
    "x5":["Chicken","Egg"], //PG
    "x6":["100 Horses","1 Horse-Sized Ducks"], //PG
    "x7":""

}

// BLACK POINT
var icons = {
    "x1":"icons/newlocation.png",
    "x2":"icons/newlocation.png",
    "x3":"icons/newlocation.png",
    "x4":"icons/newlocation.png",
    "x5":"icons/newlocation.png",
    "x6":"icons/newlocation.png",
    "x7":"icons/newlocation.png"
}

// COLORED POINTS
var newIcon = {
  "x1":"icons/DolphinWaves.png", //DW
  "x2":"icons/DolphinWaves.png", //DW
  "x3":"icons/DragonFly.png", //DF
  "x4":"icons/DragonFly.png", //DF
  "x5":"icons/ProjectGecko.png", //PG
  "x6":"icons/ProjectGecko.png", //PG
  "x7": "http://www.clker.com/cliparts/J/C/Y/S/Q/R/eye-blue-clipart-hi.png", 
}

// CUSTOM GRAPH

var customIcon= {
  "p1":["worlds/Dolphin_Waves/1-01.svg","worlds/Dolphin_Waves/1-02.svg","worlds/Dolphin_Waves/DolphinWaves.svg"],
  "p2":["worlds/Dolphin_Waves/2-01.svg","worlds/Dolphin_Waves/2-02.svg","worlds/Dolphin_Waves/DolphinWaves.svg"],
  "p3":['worlds/Dragon_Fly/1-01.svg','worlds/Dragon_Fly/1-02.svg','worlds/Dragon_Fly/DragonFly.svg'],
  "p4":['worlds/Dragon_Fly/2-01.svg','worlds/Dragon_Fly/2-02.svg','worlds/Dragon_Fly/DragonFly.svg'],
  "p5":["worlds/Project_Gecko/1-01.svg","worlds/Project_Gecko/1-02.svg","worlds/Project_Gecko/ProjectGecko.svg"],
  "p6":["worlds/Project_Gecko/2-01.svg","worlds/Project_Gecko/2-02.svg","worlds/Project_Gecko/ProjectGecko.svg"],
  "p7":""
}

var customIconBack={
  "x1": "worlds/bck/DW.png",
  "x2": "worlds/bck/DW.png",
  "x3": "worlds/bck/DF.png",
  "x4": "worlds/bck/DF.png",
  "x5": "worlds/bck/PG.png",
  "x6": "worlds/bck/PG.png",
  "x7": ""
}

var worldIcon= {
  "x1": "worlds/Dolphin_Waves/DolphinWaves.svg",
  "x2": "worlds/Dolphin_Waves/DolphinWaves.svg",
  "x3": 'worlds/Dragon_Fly/DragonFly.svg',
  "x4": 'worlds/Dragon_Fly/DragonFly.svg',
  "x5": "worlds/Project_Gecko/ProjectGecko.svg",
  "x6": "worlds/Project_Gecko/ProjectGecko.svg",
  "x7": ""
}

let array = ["x1","x2","x3","x4","x5","x6"];

// SHUFFLE
function shuffleArray(arr) {
    arr.sort(() => Math.random() - 0.5);
  }

shuffleArray(array)


// COOKIES
let co = Cookies.get();
console.log(co)



// SHOW INTRO
if  (Object.entries(co).length === 0){
  var intro = $( "#intro" );
  if (intro.css('display', 'none') ) {
    intro.fadeIn();
  } 
} else {
  checkCookies()
}


function checkCookies(){
  if (Object.entries(co).length === 0){
     //var shuffleArr = shuffleArray(arr)
    array.push('x7')
    for (c=0; c<7; c++){
      let r = array[c] 
      Cookies.set(r,r,  { expires: 60 });}
  }
}




//END
function showEnd(){
  console.log('End')
  $('#end').fadeIn()
}


// CURRENT PLACE x^n

var daje = Object.keys(co)
// console.log(daje)
let currents = []

 for (element=0;element<7;element++){
  if (daje[element].startsWith('x')){
    currents.push(daje[element])
  }
 }
let current = currents[0]


console.log("current: "+ current)

if (current == 'x7'){
  console.log('going to end')
}


// SHOW COMPLETED PLACES
let places = ["x1","x2","x3","x4","x5","x6"];
let oldPlaces = []

function showCompleted(){
  for(l = 0; l < places.length; l++){ 
    if (!Object.keys(co).includes(places[l])) { 
      oldPlaces.push(places[l])
    }}
}

showCompleted();

// SHOW STACK OF SVG | CUSTOM GRAPH
var svgChoices = ["p1","p2","p3","p4","p5","p6"];
var doneSvgChoices = []

function showCustomGraph(){
  for(pi = 0; pi < svgChoices.length; pi++){ 
    if (Object.keys(co).includes(svgChoices[pi])) { 
      doneSvgChoices.push(svgChoices[pi])
    }}

  for (const p of doneSvgChoices){
    let value = Cookies.get(p)
    $("#showPic").append(`<img src="${customIcon[p][value]}"/>`) 
  }
}
showCustomGraph()

// SET CURRENT STATE IN HTML
$('#quest').attr('src', audioQuest[current]);
$('#textquest').append(textQuest[current])
$("#title").append(title[current]);

$("#firstChoice").append(button[current][0]);
$("#secondChoice").append(button[current][1]);

$("#worldIcon").attr("src",worldIcon[current]);



// MAP

//  create map object, tell it to live in 'map' div and give initial latitude, longitude, zoom values 
var map = L.map('map', { scrollWheelZoom: false }).setView([51.90169378926979, 4.467821474386409], 12);

//  add base map tiles from OpenStreetMap and attribution info to 'map' div
var layer = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
    attribution: '<a href="http://osm.org/copyright">&copy; OpenStreetMap</a>'
}).addTo(map);

layer.getContainer().classList.add('w3-sepia');
layer.getContainer().classList.add('w3-greyscale');

// GPS ON
map.addControl(L.control.locate({
    locateOptions: {
            enableHighAccuracy: true,
}}));


//to delete the current cookie when you pass the level
function deleteItem(){
  Cookies.remove(current);  
}


// Create a TextBox with an attached event
var textbox = $('<input type="text" placeholder="codeword" />').keyup(function () {
  if(current=="x7"){
    if (event.keyCode === 13 && $(textbox).val().toUpperCase() === codeword[current]){
      showEnd()
      deleteItem()
    }
  } else{
  if (event.keyCode === 13 && $(textbox).val().toUpperCase() === codeword[current]){
    choiceToggle()
    marker.removeFrom(map)
  }}
})[0];

// specify popup options 
var customOptions =
    {
        'maxWidth': '1500',
        'className': 'custom'
    }

// New Icon's Places
let currentLong = (coord[current][0]);
let currentLat = (coord[current][1])

// CUSTOM ICON
var currentIcon = L.icon({
  iconUrl: icons[current],
  iconSize: [100, 100], // size of the icon
  popupAnchor: [0, -15]
});

// CURRENT MARKER
var marker = L.marker([currentLong,currentLat], { icon: currentIcon }).bindPopup(textbox, customOptions).addTo(map);


//PREVIOUS PLACES
for (p = 0; p<oldPlaces.length;p++){
  let neo = oldPlaces[p]

  var prevIcon = L.icon({
    iconUrl: newIcon[neo],
    iconSize: [100, 100], // size of the icon
    popupAnchor: [0, -15]
  });

  let lon = coord[neo][0];
  let lat = coord[neo][1];

  let markerLocation = new L.LatLng(lon,lat);
  let marker = new L.Marker(markerLocation, {icon: prevIcon}).on('click', onLocation);

  map.addLayer(marker)
}

function onLocation() {
  $('#audioWorldCont').html(`<h1>${titleWhile[this.getLatLng()]}</h1><br><audio src='${audioWhile[this.getLatLng()]}' controls></audio><br><button onclick="$('#audioWorld').fadeOut()">Close Me</button>`)
  $('#audioWorld').fadeIn();
}



// SHOW LEXICON
L.easyButton('fa-key', function(btn, map){
  $( "#lexicon" ).fadeIn()
}).addTo(map);

// SHOW COLOPHON
L.easyButton('fa-question-circle-o', function(btn, map){
  $( "#colophon" ).fadeIn()
}).addTo(map);

// SHOW INSTRUCTIONS
L.easyButton('fa-info-circle', function(btn, map){
  $( "#instructionsButton" ).fadeIn()
}).addTo(map);

// SHOW INFO
L.easyButton('fa-area-chart', function(btn, map){
  $( "#infoPlace" ).fadeIn()
  $( "#infoPlaceCont" ).html(`<h1>${title[current]}</h1><br><audio src="${audioWhileX[current]}" controls></audio><br><p>${getSymb[current]}</p><br><button onclick="$('#infoPlace').fadeOut()">Close Me</button>`)
}).addTo(map);

// CHOICE POPUP
var choice = $( "#choice" );

function choiceToggle() {
  if (choice.css('display', 'none') ) {
    choice.fadeIn();
  } }


// STORE CHOICE QUEST AND SHOW ONGOING CUSTOM GRAPH

let bck = customIconBack[current]

function closeMe0(){
  $( "#choice" ).fadeOut();
  deleteItem()
  let currP = current.replace("x","p");
  console.log(currP);
  Cookies.set(currP,0, { expires: 60 });

  $( "#showPicBack" ).fadeIn();

  $("#bigWhite").attr('src', bck);
  $("#showPic").append(`<img style="filter:invert(100%)" src="${customIcon[currP][0]}"/>`);
}

function closeMe1(){
  $( "#choice" ).fadeOut();
  deleteItem()
  let currP = current.replace("x","p");
  console.log(currP);
  Cookies.set(currP,0, { expires: 60 });

  $( "#showPicBack" ).fadeIn();
  
  $("#bigWhite").attr('src',bck);
  $("#showPic").append(`<img style="filter:invert(100%)" src="${customIcon[currP][1]}"/>`);
}

// DELETE COOKIES AND END GAME
function endd(){
  for(remove=0;remove<8;remove++){
  Cookies.remove(svgChoices[remove])
  }
  Cookies.remove('x7')
  location.reload()
}

// PAUSE THE GAME AT THE END //
function pause(){
  $("#end").fadeOut()
}
